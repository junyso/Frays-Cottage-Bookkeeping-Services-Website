<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Processor - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        .sidebar { width: 260px; }
        .content { margin-left: 260px; }
        .status-badge { @apply px-2 py-1 rounded text-xs font-bold; }
        .status-pending { @apply bg-yellow-100 text-yellow-800; }
        .status-ready { @apply bg-green-100 text-green-800; }
        .status-posted { @apply bg-blue-100 text-blue-800; }
        .status-rejected { @apply bg-red-100 text-red-800; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Sidebar -->
    <aside class="sidebar fixed left-0 top-0 h-full bg-slate-800 text-white p-4 overflow-y-auto">
        <div class="mb-6">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="ri-file-process-line"></i>
                Document Processor
            </h1>
            <p class="text-slate-400 text-sm mt-1">Admin Control Panel</p>
        </div>
        
        <nav class="space-y-1">
            <a href="#" onclick="showPage('dashboard')" class="nav-item flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-700 text-white">
                <i class="ri-dashboard-line"></i> Dashboard
            </a>
            <a href="#" onclick="showPage('documents')" class="nav-item flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-700 text-white">
                <i class="ri-file-list-line"></i> Documents
            </a>
            <a href="#" onclick="showPage('batches')" class="nav-item flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-700 text-white">
                <i class="ri-folder-stack-line"></i> Batches
            </a>
            <a href="#" onclick="showPage('upload')" class="nav-item flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-700 text-white">
                <i class="ri-upload-cloud-line"></i> Upload
            </a>
            <a href="#" onclick="showPage('settings')" class="nav-item flex items-center gap-3 px-3 py-2 rounded hover:bg-slate-700 text-white">
                <i class="ri-settings-3-line"></i> Settings
            </a>
        </nav>
        
        <div class="mt-6 pt-6 border-t border-slate-600">
            <h3 class="text-xs font-semibold text-slate-400 uppercase mb-2">Quick Actions</h3>
            <button onclick="createBatch()" class="w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm flex items-center gap-2">
                <i class="ri-add-line"></i> Create Batch
            </button>
            <button onclick="exportCSV()" class="w-full text-left px-3 py-2 rounded hover:bg-slate-700 text-sm flex items-center gap-2">
                <i class="ri-download-line"></i> Export CSV
            </button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="content p-6">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page">
            <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">Today's Documents</div>
                    <div class="text-3xl font-bold text-blue-600" id="stat-today">0</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">Pending Review</div>
                    <div class="text-3xl font-bold text-yellow-600" id="stat-pending">0</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">Posted to FA</div>
                    <div class="text-3xl font-bold text-green-600" id="stat-posted">0</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-500">Avg Legibility</div>
                    <div class="text-3xl font-bold text-purple-600" id="stat-legibility">0%</div>
                </div>
            </div>
            
            <!-- Charts Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="font-semibold mb-4">Document Status</h3>
                    <canvas id="statusChart" height="200"></canvas>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <h3 class="font-semibold mb-4">Processing Activity</h3>
                    <canvas id="activityChart" height="200"></canvas>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="font-semibold mb-4">Recent Documents</h3>
                <div id="recent-docs" class="space-y-2"></div>
            </div>
        </div>
        
        <!-- Documents Page -->
        <div id="page-documents" class="page hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Documents</h2>
                <div class="flex gap-2">
                    <select id="filter-status" onchange="loadDocuments()" class="border rounded px-3 py-2">
                        <option value="">All Status</option>
                        <option value="ready_for_review">Ready for Review</option>
                        <option value="pending">Pending</option>
                        <option value="posted">Posted to FA</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <button onclick="loadDocuments()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        <i class="ri-refresh-line"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left">Reference</th>
                            <th class="px-4 py-3 text-left">Client</th>
                            <th class="px-4 py-3 text-left">Uploaded</th>
                            <th class="px-4 py-3 text-left">Legibility</th>
                            <th class="px-4 py-3 text-left">Status</th>
                            <th class="px-4 py-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="documents-table"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Batches Page -->
        <div id="page-batches" class="page hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Batches</h2>
                <button onclick="createBatch()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    <i class="ri-add-line"></i> Create Batch
                </button>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200">
                    <div class="text-sm text-yellow-700">Pending Review</div>
                    <div class="text-2xl font-bold" id="batch-pending">0</div>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                    <div class="text-sm text-blue-700">Ready for FA</div>
                    <div class="text-2xl font-bold" id="batch-ready">0</div>
                </div>
                <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                    <div class="text-sm text-green-700">Posted</div>
                    <div class="text-2xl font-bold" id="batch-posted">0</div>
                </div>
            </div>
            
            <div id="batches-list" class="space-y-4"></div>
        </div>
        
        <!-- Upload Page -->
        <div id="page-upload" class="page hidden">
            <h2 class="text-2xl font-bold mb-6">Upload Documents</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Web Upload -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        <i class="ri-upload-cloud-line"></i> Web Upload
                    </h3>
                    <form id="upload-form" enctype="multipart/form-data">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">Client Code</label>
                            <input type="text" name="clientCode" class="w-full border rounded px-3 py-2" placeholder="e.g., KLES, MGB">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">Document Type</label>
                            <select name="docType" class="w-full border rounded px-3 py-2">
                                <option value="INV">Invoice</option>
                                <option value="REC">Receipt</option>
                                <option value="WAY">Waybill</option>
                                <option value="STM">Statement</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-1">Files</label>
                            <input type="file" name="documents" multiple accept=".pdf,.jpg,.jpeg,.png" class="w-full border rounded px-3 py-2">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                            Upload & Process
                        </button>
                    </form>
                </div>
                
                <!-- Upload Queue -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">Recent Uploads</h3>
                    <div id="upload-queue" class="space-y-2"></div>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="page-settings" class="page hidden">
            <h2 class="text-2xl font-bold mb-6">Settings</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- General Settings -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">General</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Default Client Code</label>
                            <input type="text" id="setting-defaultClient" class="w-full border rounded px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Document Reference Prefix</label>
                            <input type="text" id="setting-referencePrefix" class="w-full border rounded px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Min Legibility Score</label>
                            <input type="number" id="setting-minLegibility" class="w-full border rounded px-3 py-2" min="0" max="100">
                        </div>
                    </div>
                </div>
                
                <!-- Notifications -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">Notifications</h3>
                    <div class="space-y-4">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="setting-whatsapp" class="w-4 h-4">
                            <label for="setting-whatsapp">WhatsApp Notifications</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="setting-email" class="w-4 h-4">
                            <label for="setting-email">Email Notifications</label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Clerk WhatsApp Number</label>
                            <input type="text" id="setting-clerkNumber" class="w-full border rounded px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Clerk Email</label>
                            <input type="email" id="setting-clerkEmail" class="w-full border rounded px-3 py-2">
                        </div>
                    </div>
                </div>
                
                <!-- FA Integration -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">FrontAccounting API</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">API URL</label>
                            <input type="text" id="setting-faUrl" class="w-full border rounded px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Username</label>
                            <input type="text" id="setting-faUsername" class="w-full border rounded px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Password</label>
                            <input type="password" id="setting-faPassword" class="w-full border rounded px-3 py-2">
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">Actions</h3>
                    <div class="space-y-2">
                        <button onclick="saveSettings()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                            Save Settings
                        </button>
                        <button onclick="testFAConnection()" class="w-full border border-gray-300 text-gray-700 py-2 rounded hover:bg-gray-50">
                            Test FA Connection
                        </button>
                        <button onclick="exportAllData()" class="w-full border border-gray-300 text-gray-700 py-2 rounded hover:bg-gray-50">
                            Export All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Batch Modal -->
    <div id="batch-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto m-4">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold">Batch Details</h3>
                <button onclick="closeBatchModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="ri-close-line text-2xl"></i>
                </button>
            </div>
            <div class="p-6" id="batch-modal-content"></div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 space-y-2"></div>
    
    <script>
        // State
        let documents = [];
        let batches = [];
        let settings = {};
        let dashboardData = {};
        
        // API Base URL
        const API_URL = '';
        
        // Show page
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${pageName}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('bg-slate-700'));
            
            loadPageData(pageName);
        }
        
        // Load page data
        async function loadPageData(pageName) {
            switch(pageName) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'documents':
                    await loadDocuments();
                    break;
                case 'batches':
                    await loadBatches();
                    break;
                case 'settings':
                    await loadSettings();
                    break;
            }
        }
        
        // Dashboard
        async function loadDashboard() {
            try {
                const res = await fetch(`${API_URL}/api/dashboard`);
                dashboardData = await res.json();
                
                document.getElementById('stat-today').textContent = dashboardData.stats.todayDocuments;
                document.getElementById('stat-pending').textContent = dashboardData.stats.pendingReview;
                document.getElementById('stat-posted').textContent = dashboardData.stats.postedToday;
                document.getElementById('stat-legibility').textContent = dashboardData.stats.legibilityScore + '%';
                
                // Recent docs
                const recentHtml = dashboardData.recentDocuments.map(doc => `
                    <div class="flex items-center justify-between py-2 border-b">
                        <div>
                            <div class="font-medium">${doc.reference}</div>
                            <div class="text-sm text-gray-500">${doc.clientCode}</div>
                        </div>
                        <span class="status-badge status-${doc.status}">${doc.status}</span>
                    </div>
                `).join('');
                document.getElementById('recent-docs').innerHTML = recentHtml || '<p class="text-gray-500">No documents yet</p>';
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }
        
        // Documents
        async function loadDocuments() {
            const status = document.getElementById('filter-status').value;
            const url = status ? `${API_URL}/api/documents?status=${status}` : `${API_URL}/api/documents`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                documents = data.documents;
                
                const html = documents.map(doc => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-3 font-mono text-sm">${doc.reference}</td>
                        <td class="px-4 py-3">${doc.clientCode}</td>
                        <td class="px-4 py-3 text-sm">${new Date(doc.uploadedAt).toLocaleString()}</td>
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-2">
                                <div class="w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-${doc.legibilityScore >= 70 ? 'green' : 'red'}-500 h-2 rounded-full" style="width: ${doc.legibilityScore}%"></div>
                                </div>
                                <span class="text-sm">${doc.legibilityScore?.toFixed(1)}%</span>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="status-badge status-${doc.status}">${doc.status}</span>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="viewDocument('${doc.id}')" class="text-blue-600 hover:text-blue-800 mr-2">
                                <i class="ri-eye-line"></i>
                            </button>
                            <button onclick="downloadDocument('${doc.id}')" class="text-green-600 hover:text-green-800">
                                <i class="ri-download-line"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                document.getElementById('documents-table').innerHTML = html || '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">No documents found</td></tr>';
            } catch (error) {
                console.error('Documents load error:', error);
            }
        }
        
        // Batches
        async function loadBatches() {
            try {
                const res = await fetch(`${API_URL}/api/batches`);
                const data = await res.json();
                batches = data.batches;
                
                document.getElementById('batch-pending').textContent = data.stats.pending;
                document.getElementById('batch-ready').textContent = data.stats.ready;
                document.getElementById('batch-posted').textContent = data.stats.posted;
                
                const html = batches.map(batch => `
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <div class="font-semibold">Batch ${batch.id.substring(0, 8)}</div>
                                <div class="text-sm text-gray-500">${batch.documents.length} documents | ${batch.clientCode}</div>
                            </div>
                            <span class="status-badge status-${batch.status}">${batch.status}</span>
                        </div>
                        <div class="text-sm text-gray-500 mb-3">
                            Created: ${new Date(batch.createdAt).toLocaleString()}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="viewBatch('${batch.id}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                View
                            </button>
                            ${batch.status === 'pending_review' ? `
                                <button onclick="approveBatch('${batch.id}')" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                    Approve
                                </button>
                            ` : ''}
                            ${batch.status === 'ready_for_fa' ? `
                                <button onclick="postBatchToFA('${batch.id}')" class="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700">
                                    Post to FA
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
                document.getElementById('batches-list').innerHTML = html || '<p class="text-gray-500">No batches created yet</p>';
            } catch (error) {
                console.error('Batches load error:', error);
            }
        }
        
        // View batch
        async function viewBatch(batchId) {
            try {
                const res = await fetch(`${API_URL}/api/batches/${batchId}`);
                const batch = await res.json();
                
                const docs = batch.documents.map(d => `
                    <div class="flex justify-between items-center py-2 border-b">
                        <div>
                            <div class="font-mono">${d.reference}</div>
                            <div class="text-sm text-gray-500">${d.clientCode}</div>
                        </div>
                        <span class="status-badge status-${d.status}">${d.status}</span>
                    </div>
                `).join('');
                
                document.getElementById('batch-modal-content').innerHTML = `
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">Documents (${batch.documents.length})</h4>
                        ${docs}
                    </div>
                    <div class="mb-4">
                        <h4 class="font-semibold mb-2">CSV Preview</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-auto max-h-64">${batch.csvPreview}</pre>
                    </div>
                `;
                document.getElementById('batch-modal').classList.remove('hidden');
            } catch (error) {
                showToast('Error loading batch: ' + error.message, 'error');
            }
        }
        
        function closeBatchModal() {
            document.getElementById('batch-modal').classList.add('hidden');
        }
        
        // Create batch from ready documents
        async function createBatch() {
            const readyDocs = documents.filter(d => d.status === 'ready_for_review');
            if (readyDocs.length === 0) {
                showToast('No documents ready for batching', 'warning');
                return;
            }
            
            try {
                const res = await fetch(`${API_URL}/api/batches`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        documentIds: readyDocs.map(d => d.id)
                    })
                });
                const batch = await res.json();
                
                showToast('Batch created successfully!', 'success');
                loadBatches();
            } catch (error) {
                showToast('Error creating batch: ' + error.message, 'error');
            }
        }
        
        // Approve batch
        async function approveBatch(batchId) {
            try {
                await fetch(`${API_URL}/api/batches/${batchId}/approve`, { method: 'POST' });
                showToast('Batch approved!', 'success');
                loadBatches();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }
        
        // Post to FA
        async function postBatchToFA(batchId) {
            if (!confirm('Post this batch to FrontAccounting?')) return;
            
            try {
                const res = await fetch(`${API_URL}/api/batches/${batchId}/post-to-fa`, { 
                    method: 'POST' 
                });
                const result = await res.json();
                
                if (result.faPostStatus?.success) {
                    showToast('Batch posted to FA successfully!', 'success');
                } else {
                    showToast('FA posting failed: ' + result.faPostStatus?.error, 'error');
                }
                loadBatches();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }
        
        // Upload form
        document.getElementById('upload-form').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const res = await fetch(`${API_URL}/api/upload`, {
                    method: 'POST',
                    body: formData
                });
                const result = await res.json();
                
                if (result.success) {
                    showToast(`Processed: ${result.processed} docs, ${result.rejected} rejected`, 'success');
                    e.target.reset();
                    loadDashboard();
                } else {
                    showToast('Upload failed: ' + result.error, 'error');
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        };
        
        // Settings
        async function loadSettings() {
            try {
                const res = await fetch(`${API_URL}/api/settings`);
                settings = await res.json();
                
                document.getElementById('setting-defaultClient').value = settings.defaultClient || '';
                document.getElementById('setting-referencePrefix').value = settings.referencePrefix || 'INV';
                document.getElementById('setting-clerkNumber').value = settings.clerkContact || '';
                document.getElementById('setting-clerkEmail').value = settings.clerkEmail || '';
            } catch (error) {
                console.error('Settings load error:', error);
            }
        }
        
        async function saveSettings() {
            settings = {
                defaultClient: document.getElementById('setting-defaultClient').value,
                referencePrefix: document.getElementById('setting-referencePrefix').value,
                clerkContact: document.getElementById('setting-clerkNumber').value,
                clerkEmail: document.getElementById('setting-clerkEmail').value
            };
            
            try {
                await fetch(`${API_URL}/api/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                showToast('Settings saved!', 'success');
            } catch (error) {
                showToast('Error saving settings', 'error');
            }
        }
        
        // Toast notifications
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bg = type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600';
            toast.className = `${bg} text-white px-4 py-2 rounded shadow-lg flex items-center gap-2`;
            toast.innerHTML = `<i class="ri-${type === 'success' ? 'check-line' : type === 'error' ? 'error-warning-line' : 'information-line'}"></i> ${message}`;
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => toast.remove(), 5000);
        }
        
        // View document
        function viewDocument(id) {
            const doc = documents.find(d => d.id === id);
            if (!doc) return;
            
            const content = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><strong>Reference:</strong> ${doc.reference}</div>
                        <div><strong>Client:</strong> ${doc.clientCode}</div>
                        <div><strong>Uploaded:</strong> ${new Date(doc.uploadedAt).toLocaleString()}</div>
                        <div><strong>Status:</strong> ${doc.status}</div>
                        <div><strong>Legibility:</strong> ${doc.legibilityScore?.toFixed(1)}%</div>
                    </div>
                    <div>
                        <strong>Processing Log:</strong>
                        <pre class="bg-gray-100 p-4 rounded text-sm mt-2">${JSON.stringify(doc.processingLog, null, 2)}</pre>
                    </div>
                    ${doc.ocrPreview ? `
                        <div>
                            <strong>OCR Preview:</strong>
                            <pre class="bg-gray-100 p-4 rounded text-sm mt-2 max-h-48 overflow-auto">${doc.ocrPreview}</pre>
                        </div>
                    ` : ''}
                </div>
            `;
            document.getElementById('batch-modal-content').innerHTML = content;
            document.getElementById('batch-modal').classList.remove('hidden');
        }
        
        // Initialize
        showPage('dashboard');
    </script>
</body>
</html>
